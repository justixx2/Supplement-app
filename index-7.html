<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="theme-color" content="#FAFAF8"/>
<title>SupStack</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíä</text></svg>"/>
<link rel="manifest" href="manifest.json"/>
<link rel="apple-touch-icon" href="icon-192.png"/>
<meta name="apple-mobile-web-app-title" content="SupStack"/>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700;9..40,800&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;font-family:'DM Sans',-apple-system,sans-serif;-webkit-tap-highlight-color:transparent}
html,body{margin:0;padding:0;background:#F5F5F0;height:100%;overflow:hidden}
#root{height:100%;overflow:hidden}
input,select,textarea,button{font-family:inherit}
input[type=range]{-webkit-appearance:none;height:6px;border-radius:3px;background:#E5E7EB;outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#4ADE80;cursor:pointer;border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.15)}
input[type=search]{-webkit-appearance:none}
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-thumb{background:#D1D5DB;border-radius:2px}
select{-webkit-appearance:none;appearance:none}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
@keyframes slideUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:none}}
.fi{animation:fadeIn .25s ease}.su{animation:slideUp .25s ease}
</style>
</head>
<body>
<div id="root"></div>
<script>if('serviceWorker' in navigator)navigator.serviceWorker.register('./sw.js');</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const{useState,useEffect,useCallback,useMemo,useRef,useContext,createContext}=React;

/* ‚îÄ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ */
const PRESETS=[
{name:"L-Glutamine",cat:"amino-acid",r:{wf:"no",bt:"Morning",boost:"Empty stomach, wait 30min before food",confl:[],note:"Gut lining repair, immune fuel, muscle recovery."}},
{name:"Collagen",cat:"protein",r:{wf:"no",bt:"Morning",boost:"Vitamin C required for synthesis",confl:[],note:"Skin, joints, gut lining. Empty stomach for gut healing."}},
{name:"Spermidine",cat:"other",r:{wf:"no",bt:"Morning",boost:"Fasting state enhances autophagy",confl:[],note:"Induces autophagy, longevity. Empty stomach."}},
{name:"Colostrum",cat:"protein",r:{wf:"no",bt:"Morning",boost:"Dose 2 at dinner or bedtime if recommended",confl:[],note:"Growth factors (IGF-1), immune, gut healing."}},
{name:"Zinc Carnosine",cat:"mineral-complex",r:{wf:"no",bt:"Morning",boost:"30min before food for max gut contact",confl:[{n:"Copper Gluconate",m:720,eff:"Zinc blocks copper absorption ~50-60%"},{n:"Iron Bisglycinate",m:120,eff:"Competes for absorption pathway"}],note:"Stomach/gut lining repair. Japanese clinical use."}},
{name:"L. Casei Calm 37",cat:"other",r:{wf:"no",bt:"Morning",boost:"Room temp water, avoid heat",confl:[{n:"Oregano Oil",m:240,eff:"Antimicrobial kills probiotic bacteria"}],note:"Calming probiotic, gut-brain axis, GABA production."}},
{name:"TWK10 / L. plantarum",cat:"other",r:{wf:"no",bt:"Morning",boost:"Room temp water",confl:[{n:"Oregano Oil",m:240,eff:"Antimicrobial kills probiotic bacteria"}],note:"Sport probiotic ‚Äî endurance, muscle, performance."}},
{name:"L. Rhamnosus GG",cat:"other",r:{wf:"no",bt:"Morning",boost:"Can combine with other probiotic strains",confl:[{n:"Oregano Oil",m:240,eff:"Broad antimicrobial activity kills bacteria"}],note:"Most studied probiotic worldwide. Immune + gut."}},
{name:"Cod Liver Oil (Moller's)",cat:"fat-soluble",r:{wf:"fat",bt:"Morning",boost:"2 tsp with fat breakfast (eggs, salmon)",confl:[],note:"Omega-3, natural Vit A + D. Moller's liquid."}},
{name:"Vitamin D3",cat:"fat-soluble",r:{wf:"fat",bt:"Morning",boost:"ALWAYS pair with K2. 3500 IU total with CLO",confl:[],note:"Fat-soluble. Immune, mood, testosterone, bones."}},
{name:"Vitamin K2 MK-7",cat:"fat-soluble",r:{wf:"fat",bt:"Morning",boost:"Essential D3 companion ‚Äî directs calcium to bones",confl:[],note:"Prevents arterial calcification. Take with D3."}},
{name:"Magnesium Citrate/Malate",cat:"mineral",r:{wf:"yes",bt:"Morning",boost:"Thorne 2 caps (270mg). ~10-15% reduced w/ zinc ‚Äî acceptable",confl:[{n:"Iron Bisglycinate",m:120,eff:"Mag interferes with iron absorption"},{n:"Zinc Glycinate",m:0,eff:"~10-15% absorption reduction ‚Äî acceptable for simplicity"}],note:"Energy (malate), bowel support (citrate). Daytime mag."}},
{name:"Vitamin B6 (P5P)",cat:"water-soluble",r:{wf:"yes",bt:"Morning",boost:"Active form, no liver conversion needed",confl:[],note:"Neurotransmitters, mag transport. Monitor at 50mg."}},
{name:"Vitamin B1 (Thiamine)",cat:"water-soluble",r:{wf:"yes",bt:"Morning",boost:"",confl:[],note:"Energy metabolism, nervous system. 100mg. Very safe."}},
{name:"Vitamin C",cat:"water-soluble",r:{wf:"yes",bt:"Morning",boost:"Enhances iron absorption, required for collagen",confl:[{n:"Copper Gluconate",m:720,eff:"High-dose C reduces copper absorption ~30%"}],note:"Antioxidant, immune, collagen synthesis. 500-1000mg."}},
{name:"Iodine",cat:"mineral",r:{wf:"yes",bt:"Morning",boost:"CYCLE 2-3x/week ONLY. Take with selenium. Avoid goitrogens",confl:[],note:"1830mcg/drop ‚Äî above daily limit. Must cycle."}},
{name:"Lutein with Zeaxanthin",cat:"fat-soluble",r:{wf:"fat",bt:"Morning",boost:"CLO fat improves absorption",confl:[],note:"Macular protection, blue light filter. Fat-soluble."}},
{name:"Selenium (Brazil Nuts)",cat:"mineral",r:{wf:"yes",bt:"Morning",boost:"3 Brazil nuts. Essential on iodine days",confl:[],note:"Thyroid protection, glutathione. Max 4 nuts/day."}},
{name:"Zinc Glycinate",cat:"mineral",r:{wf:"yes",bt:"Morning",boost:"",confl:[{n:"Copper Gluconate",m:720,eff:"Zinc blocks copper absorption 50-60%"},{n:"Lactoferrin",m:480,eff:"Lactoferrin binds minerals including zinc"},{n:"Magnesium Citrate/Malate",m:0,eff:"~10-15% reduction ‚Äî acceptable"},{n:"Iron Bisglycinate",m:120,eff:"Competes for absorption"}],note:"Immune, testosterone, skin. Copper at dinner = 12h apart."}},
{name:"Cordyceps",cat:"adaptogen",r:{wf:"yes",bt:"Morning",boost:"",confl:[],note:"ATP, oxygen, kidney, testosterone. Sport mushroom."}},
{name:"Niacin",cat:"water-soluble",r:{wf:"yes",bt:"Anytime",boost:"AS NEEDED for overmethylation/wired feeling",confl:[],note:"Flush form. Depletes excess methyl groups. Start low."}},
{name:"Plant Enzymes",cat:"other",r:{wf:"yes",bt:"Evening",boost:"Take with FIRST bites of dinner before other supps",confl:[],note:"Bromelain + papain. Protein digestion, anti-inflammatory."}},
{name:"Copper Gluconate",cat:"mineral",r:{wf:"yes",bt:"Evening",boost:"Dinner = 12+ hours from breakfast zinc",confl:[{n:"Zinc Glycinate",m:720,eff:"Zinc blocks copper absorption 50-60%"},{n:"Vitamin C",m:720,eff:"High-dose C reduces copper absorption ~30%"},{n:"Zinc Carnosine",m:720,eff:"Any zinc form competes with copper"}],note:"2mg. Collagen crosslinking, iron metabolism."}},
{name:"Taurine",cat:"amino-acid",r:{wf:"no",bt:"Evening",boost:"Supports magnesium retention",confl:[],note:"Heart, calming, bile, longevity amino acid. 500-1000mg."}},
{name:"Oregano Oil",cat:"other",r:{wf:"yes",bt:"Evening",boost:"CYCLE: 2-3 weeks on, rotate to caprylic acid",confl:[{n:"L. Rhamnosus GG",m:240,eff:"Kills beneficial bacteria"},{n:"L. Casei Calm 37",m:240,eff:"Antimicrobial kills probiotics"},{n:"TWK10 / L. plantarum",m:240,eff:"Antimicrobial kills probiotics"}],note:"Antifungal/antimicrobial. Must cycle. 4h from probiotics."}},
{name:"Vitamin E Complex",cat:"fat-soluble",r:{wf:"fat",bt:"Evening",boost:"Mixed tocopherols + tocotrienols, not isolated alpha",confl:[],note:"Protects omega-3 from oxidation. Skin, heart."}},
{name:"NAG (N-Acetyl Glucosamine)",cat:"other",r:{wf:"no",bt:"Evening",boost:"",confl:[],note:"Gut mucous lining repair. IBD support. Not joint glucosamine."}},
{name:"Bacopa",cat:"adaptogen",r:{wf:"fat",bt:"Evening",boost:"8-12 weeks for full effect. Consistent daily use",confl:[],note:"Memory, learning, cognitive. Fat-soluble bacosides."}},
{name:"Berberine",cat:"other",r:{wf:"yes",bt:"Evening",boost:"CYCLE: 8 weeks on, 4 weeks off",confl:[],note:"Blood sugar, cholesterol. AMPK activator. Drug-like potency."}},
{name:"Milk Thistle",cat:"other",r:{wf:"yes",bt:"Evening",boost:"Supports liver during oregano + berberine use",confl:[],note:"Premier liver support. Silymarin protects + regenerates."}},
{name:"Astragalus",cat:"adaptogen",r:{wf:"yes",bt:"Evening",boost:"",confl:[],note:"Telomerase activation, kidney, immune. Longevity herb."}},
{name:"Pharma GABA",cat:"amino-acid",r:{wf:"no",bt:"Before bed",boost:"Chewable form absorbs faster (sublingual)",confl:[],note:"Natural GABA. Calms neural activity. Non-habit-forming."}},
{name:"L-Theanine",cat:"amino-acid",r:{wf:"no",bt:"Before bed",boost:"Suntheanine brand most studied",confl:[],note:"Alpha brain waves, calm without sedation. 200mg."}},
{name:"Magnesium Threonate",cat:"mineral",r:{wf:"no",bt:"Before bed",boost:"BRAIN magnesium ‚Äî different from morning mag",confl:[],note:"Only mag proven to cross BBB. Memory, sleep, cognition."}},
{name:"Magnesium Taurate",cat:"mineral",r:{wf:"no",bt:"Before bed",boost:"Optional addition",confl:[],note:"Heart rhythm, cardiovascular. Mag + taurine combined."}},
{name:"Inositol",cat:"water-soluble",r:{wf:"no",bt:"Before bed",boost:"Higher doses (12-18g) for anxiety/OCD",confl:[],note:"Serotonin pathway. Sleep, anxiety, panic. 500mg."}},
{name:"Lactoferrin",cat:"protein",r:{wf:"no",bt:"Before bed",boost:"8+ hours from breakfast zinc",confl:[{n:"Zinc Glycinate",m:480,eff:"Lactoferrin binds minerals including zinc"}],note:"Immune protein. Antimicrobial. Binds iron from pathogens."}},
{name:"Reishi",cat:"adaptogen",r:{wf:"no",bt:"Before bed",boost:"Hot water or dual extract for full spectrum",confl:[],note:"Mushroom of Immortality. Sleep, immune, anti-cancer."}},
{name:"NAC (N-Acetyl Cysteine)",cat:"amino-acid",r:{wf:"no",bt:"Before bed",boost:"Breaks biofilms ‚Äî synergistic with oregano oil",confl:[],note:"Glutathione precursor. Liver detox, biofilm breaker."}},
{name:"S. Boulardii",cat:"other",r:{wf:"no",bt:"Before bed",boost:"4+ hours from oregano. Lower stomach acid at night = better survival",confl:[{n:"Oregano Oil",m:240,eff:"Some antimicrobial effect, though S. boulardii is more resistant than bacteria"}],note:"Beneficial YEAST probiotic. Resistant to antibiotics."}},
{name:"Lion's Mane",cat:"adaptogen",r:{wf:"yes",bt:"Morning",boost:"Dual extract. Optional ‚Äî some days. Cumulative NGF effects",confl:[],note:"Only known NGF stimulator. Brain, memory, neuroprotective."}},
{name:"Pleurotus (Oyster Mushroom)",cat:"other",r:{wf:"yes",bt:"Evening",boost:"Natural lovastatin ‚Äî works best in evening. Or eat fresh",confl:[],note:"Natural statin alternative. Cholesterol, heart. Dad's protocol."}},
{name:"Curcumin",cat:"other",r:{wf:"fat",bt:"Evening",boost:"MUST use piperine or liposomal form (<1% absorption otherwise)",confl:[{n:"Iron Bisglycinate",m:120,eff:"Curcumin inhibits iron absorption"}],note:"Anti-inflammatory = NSAIDs. Crosses BBB. Joints, brain. Dad's."}},
{name:"CoQ10 (Ubiquinol)",cat:"fat-soluble",r:{wf:"fat",bt:"Evening",boost:"Use UBIQUINOL not ubiquinone. Essential if using pleurotus",confl:[],note:"Mitochondrial energy. Declines after 50. Heart. Dad's protocol."}},
{name:"Fulvic Mineral Concentrate",cat:"mineral",r:{wf:"yes",bt:"Evening",boost:"Liquid in water. Start low dose",confl:[],note:"70+ trace minerals. Enhances absorption. Dad's protocol."}},
{name:"Vitamin B Complex",cat:"water-soluble",r:{wf:"yes",bt:"Morning",boost:"Low-dose complex for balanced B support",confl:[],note:"Homocysteine control, energy, nervous system. Dad's protocol."}},
];
const CC={"fat-soluble":"#F59E0B","water-soluble":"#3B82F6",mineral:"#10B981",adaptogen:"#8B5CF6",other:"#6B7280","amino-acid":"#EC4899","mineral-complex":"#14B8A6",protein:"#F97316"};
const FI={fat:"\u{1F951}",yes:"\u{1F37D}\uFE0F",no:"\u{1F48A}"};
const TI={Morning:"\u{1F305}",Midday:"\u2600\uFE0F",Evening:"\u{1F306}","Before bed":"\u{1F319}",Anytime:"\u23F0"};

/* ‚îÄ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ */
const uid=()=>Math.random().toString(36).substr(2,9)+Date.now().toString(36);
const fmtT=(h,m)=>(h%12||12)+":"+String(m).padStart(2,"0")+" "+(h>=12?"PM":"AM");
const prsT=s=>{if(!s)return null;const[t,p]=s.split(" ");let[h,m]=t.split(":").map(Number);if(p==="PM"&&h!==12)h+=12;if(p==="AM"&&h===12)h=0;return{h,m}};
const tdy=()=>{const d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")};
function useLS(k,iv){const[v,sV]=useState(()=>{try{const x=localStorage.getItem(k);return x?JSON.parse(x):iv}catch{return iv}});useEffect(()=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}},[k,v]);return[v,sV]}

/* ‚îÄ‚îÄ‚îÄ CONTEXT ‚îÄ‚îÄ‚îÄ */
const Ctx=createContext();

/* ‚îÄ‚îÄ‚îÄ STANDALONE TIMER COMPONENTS (own tick, no parent re-render) ‚îÄ‚îÄ‚îÄ */
function Elapsed({iso}){
  const[,tick]=useState(0);
  useEffect(()=>{const i=setInterval(()=>tick(t=>t+1),15000);return()=>clearInterval(i)},[]);
  const ms=Date.now()-new Date(iso).getTime();
  const m=Math.floor(ms/60000);
  const txt=m<1?"just now":m<60?m+"m ago":Math.floor(m/60)+"h"+(m%60>0?" "+m%60+"m":"")+" ago";
  return <span style={{fontSize:10,color:"#059669",background:"#DCFCE7",padding:"1px 6px",borderRadius:4,fontWeight:600}}>{"‚è±"} {txt}</span>;
}

function ConflictTimer({takenAt,reqMin,onExpire}){
  const[,tick]=useState(0);
  const expiredRef=useRef(false);
  useEffect(()=>{const i=setInterval(()=>tick(t=>t+1),15000);return()=>clearInterval(i)},[]);
  const elapsed=(Date.now()-new Date(takenAt).getTime())/60000;
  const rem=Math.ceil(reqMin-elapsed);
  useEffect(()=>{if(rem<=0&&!expiredRef.current&&onExpire){expiredRef.current=true;onExpire();}},[rem]);
  if(rem<=0)return null;
  return <span style={{fontSize:10,color:"#D97706"}}>{"‚ö†Ô∏è"} {rem}min left</span>;
}

/* ‚îÄ‚îÄ‚îÄ SMALL COMPONENTS ‚îÄ‚îÄ‚îÄ */
const Bdg=({st})=>{const m={taken:{bg:"#DCFCE7",c:"#16A34A",t:"Taken"},ready:{bg:"#D1FAE5",c:"#059669",t:"Ready"},blocked:{bg:"#FEF3C7",c:"#D97706",t:"Blocked"},overdue:{bg:"#FEE2E2",c:"#DC2626",t:"Overdue"},pending:{bg:"#F3F4F6",c:"#6B7280",t:"Upcoming"}};const s=m[st]||m.pending;return <span style={{background:s.bg,color:s.c,padding:"2px 8px",borderRadius:20,fontSize:10,fontWeight:700}}>{s.t}</span>;};
const Ring=({p})=>{const sz=56,r=(sz-8)/2,c=2*Math.PI*r,o=c-(p/100)*c;return <svg width={sz} height={sz} style={{transform:"rotate(-90deg)"}}><circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke="#E5E7EB" strokeWidth="5"/><circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke="#4ADE80" strokeWidth="5" strokeDasharray={c} strokeDashoffset={o} strokeLinecap="round" style={{transition:"stroke-dashoffset .5s"}}/></svg>;};
const Mt=({children})=><span style={{display:"inline-flex",alignItems:"center",gap:3,background:"#F3F4F6",borderRadius:6,padding:"2px 7px",fontSize:10,fontWeight:500,color:"#6B7280"}}>{children}</span>;

/* ‚îÄ‚îÄ‚îÄ SUPPLEMENT CARD (outside App ‚Äî stable reference) ‚îÄ‚îÄ‚îÄ */
function SC({s}){
  const{tl,supps,timers,setEditing,setView,doTake,doUntake,hidden,setHidden,alerts}=useContext(Ctx);
  const touchRef=useRef(null);
  const cardRef=useRef(null);
  const[offset,setOffset]=useState(0);

  /* bidirectional conflict check */
  const getMyConf=()=>{
    const c=[];
    /* forward: my conflicts list */
    if(s.confl?.length){for(const cf of s.confl){const cs=supps.find(x=>x.name===cf.n);if(!cs)continue;const tt=timers[cs.id+"_t"];if(!tt)continue;const el=(Date.now()-new Date(tt).getTime())/60000,req=cf.m||120;if(el<req)c.push({name:cs.name,rem:Math.ceil(req-el),total:req,eff:cf.eff||"",takenAt:tt});}}
    /* reverse: other supps that list ME as conflict */
    for(const os of supps){if(os.id===s.id||!os.confl?.length)continue;for(const cf of os.confl){if(cf.n!==s.name)continue;const tt=timers[os.id+"_t"];if(!tt)continue;const el=(Date.now()-new Date(tt).getTime())/60000,req=cf.m||120;if(el<req&&!c.find(x=>x.name===os.name))c.push({name:os.name,rem:Math.ceil(req-el),total:req,eff:cf.eff||"Absorption may be reduced",takenAt:tt});}}
    return c;
  };
  const cf=getMyConf();
  const done=!!tl[s.id];
  const st=done?"taken":cf.length?"blocked":(() => {if(s.times?.[0]){const t=prsT(s.times[0]);if(t){const nd=new Date(),nm=nd.getHours()*60+nd.getMinutes(),sm=t.h*60+t.m;if(nm>sm+30)return"overdue";if(nm>=sm-15&&nm<=sm+15)return"ready";}}return"pending";})();
  const cc=CC[s.cat]||"#6B7280";
  const logEntry=tl[s.id];

  const notify=(title,body)=>{if(alerts&&Notification.permission==="granted")new Notification(title,{body,icon:"üíä"});};

  /* swipe handlers */
  const onTS=e=>{touchRef.current=e.touches[0].clientX;};
  const onTM=e=>{if(touchRef.current===null)return;const dx=e.touches[0].clientX-touchRef.current;setOffset(Math.max(0,dx));};
  const onTE=()=>{if(offset>100){setHidden(p=>{const k=tdy();return{...p,[k]:[...(p[k]||[]),s.id]};});setOffset(0);}else{setOffset(0);}touchRef.current=null;};

  return <div ref={cardRef} onTouchStart={onTS} onTouchMove={onTM} onTouchEnd={onTE}
    style={{background:done?"#F0FDF4":"#fff",borderRadius:16,padding:"12px 14px",marginBottom:8,borderLeft:"4px solid "+(done?"#4ADE80":cc),boxShadow:"0 1px 3px rgba(0,0,0,.04)",transform:"translateX("+offset+"px)",transition:offset===0?"transform .2s":"none",position:"relative",overflow:"hidden"}}>
    {offset>50&&<div style={{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",fontSize:11,color:"#9CA3AF",fontWeight:600}}>{"üëã"} Hide</div>}
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
      <div style={{flex:1,minWidth:0}}>
        <div style={{display:"flex",alignItems:"center",gap:7,flexWrap:"wrap",marginBottom:2}}>
          <span style={{fontSize:14,fontWeight:700,color:done?"#16A34A":"#1a1a1a"}}>{s.name}</span>
          <Bdg st={st}/>
        </div>
        <div style={{display:"flex",gap:4,flexWrap:"wrap",marginTop:4}}>
          {s.times?.[0]&&<Mt>{s.times[0]}</Mt>}
          {s.wf&&<Mt>{FI[s.wf]||""} {s.wf==="fat"?"With fat":s.wf==="no"?"Empty stomach":"With food"}</Mt>}
          {s.dosage&&<Mt>{s.dosage}</Mt>}
        </div>
        {s.boost&&<p style={{fontSize:10,color:"#6B7280",margin:"4px 0 0"}}>{"üí°"} {s.boost}</p>}
        {cf.map((c,i)=><div key={i} style={{fontSize:10,color:"#D97706",marginTop:3}}>
          <ConflictTimer takenAt={c.takenAt} reqMin={c.total} onExpire={()=>notify("Ready!",s.name+" can now be taken safely")}/>
          {" "}{c.name}{c.eff&&<span style={{color:"#B45309"}}> ‚Äî {c.eff}</span>}
        </div>)}
        {done&&logEntry&&<div style={{display:"flex",alignItems:"center",gap:6,marginTop:4}}>
          <span style={{fontSize:10,color:"#16A34A",fontWeight:600}}>{"‚úì"} {new Date(logEntry.time).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}</span>
          <Elapsed iso={logEntry.time}/>
        </div>}
      </div>
      <div style={{display:"flex",gap:5,alignItems:"center",marginLeft:6,flexShrink:0}}>
        <button onClick={()=>{setEditing(s);setView("add");}} style={{background:"none",border:"none",cursor:"pointer",padding:3,color:"#9CA3AF",fontSize:14}}>{"‚úèÔ∏è"}</button>
        {done
          ?<button onClick={()=>doUntake(s.id)} style={{...Z.tb,background:"#4ADE80",color:"#fff"}}>{"‚úì"}</button>
          :<button onClick={()=>doTake(s,cf)} style={{...Z.tb,background:st==="blocked"?"#FEF3C7":"#fff",color:st==="blocked"?"#D97706":"#D1D5DB",border:st==="blocked"?"2px solid #FCD34D":"2px solid #E5E7EB"}}>{"‚úì"}</button>
        }
      </div>
    </div>
  </div>;
}

/* ‚îÄ‚îÄ‚îÄ FORM (outside App ‚Äî stable, keeps own state across App re-renders) ‚îÄ‚îÄ‚îÄ */
function SF({init,onSave,onDel,onBack,supps,stacks}){
const[f,sF]=useState(init||{name:"",cat:"other",brand:"",dosage:"",times:[],wf:"yes",es:false,bt:"Morning",boost:"",confl:[],fi:"",note:"",stackId:null});
const[nt,sNt]=useState("08:00");
const[cn,sCn]=useState("");
const[cm,sCm]=useState(120);
const[ce,sCe]=useState("");
const addT=()=>{const[h,m]=nt.split(":").map(Number);const s=fmtT(h,m);if(!f.times.includes(s))sF(p=>({...p,times:[...p.times,s]}));};
const addC=()=>{if(cn.trim()){sF(p=>({...p,confl:[...p.confl,{n:cn.trim(),m:cm,eff:ce.trim()}]}));sCn("");sCe("");}};
return <div>
  <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16}}>
    <button onClick={onBack} style={{background:"none",border:"none",cursor:"pointer",fontSize:13,fontWeight:600,color:"#4ADE80"}}>{"< Back"}</button>
    <span style={{fontSize:17,fontWeight:800,color:"#111"}}>{init?.id?"Edit":"Add"} Supplement</span>
    <div style={{width:50}}/>
  </div>
  <div style={Z.fc}>
    <label style={Z.lb}>Name *</label>
    <input style={Z.ip} value={f.name} onChange={e=>sF(p=>({...p,name:e.target.value}))} placeholder="e.g. Copper Bisglycinate"/>
    <label style={Z.lb}>Category</label>
    <select style={Z.ip} value={f.cat} onChange={e=>sF(p=>({...p,cat:e.target.value}))}>{Object.keys(CC).map(c=><option key={c} value={c}>{c}</option>)}</select>
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
      <div><label style={Z.lb}>Brand</label><input style={Z.ip} value={f.brand||""} onChange={e=>sF(p=>({...p,brand:e.target.value}))} placeholder="Optional"/></div>
      <div><label style={Z.lb}>Dosage</label><input style={Z.ip} value={f.dosage||""} onChange={e=>sF(p=>({...p,dosage:e.target.value}))} placeholder="e.g. 2mg"/></div>
    </div>
  </div>
  <div style={Z.fc}>
    <span style={Z.st}>{"‚è∞"} Schedule</span>
    <label style={Z.lb}>Best Time</label>
    <div style={{display:"flex",gap:5,flexWrap:"wrap",marginBottom:10}}>
      {["Morning","Midday","Evening","Before bed","Anytime"].map(t=><button key={t} onClick={()=>sF(p=>({...p,bt:t}))} style={{...Z.ch,...(f.bt===t?Z.cA:{})}}>{TI[t]} {t}</button>)}
    </div>
    <label style={Z.lb}>Specific Times</label>
    <div style={{display:"flex",gap:6,marginBottom:6}}>
      <input type="time" value={nt} onChange={e=>sNt(e.target.value)} style={{...Z.ip,marginBottom:0,flex:1}}/>
      <button onClick={addT} style={Z.ab}>Add</button>
    </div>
    <div style={{display:"flex",gap:5,flexWrap:"wrap"}}>{f.times.map(t=><span key={t} style={{background:"#F3F4F6",borderRadius:7,padding:"3px 8px",fontSize:11}}>{t} <button onClick={()=>sF(p=>({...p,times:p.times.filter(x=>x!==t)}))} style={{background:"none",border:"none",color:"#9CA3AF",cursor:"pointer"}}>x</button></span>)}</div>
  </div>
  <div style={Z.fc}>
    <span style={Z.st}>{"üß¨"} Absorption</span>
    <div style={{display:"flex",gap:5,flexWrap:"wrap",marginBottom:10}}>
      {[["yes","With Food üçΩÔ∏è"],["no","Empty Stomach üíä"],["fat","With Fat ü•ë"]].map(([v,l])=><button key={v} onClick={()=>sF(p=>({...p,wf:v,es:v==="no"}))} style={{...Z.ch,...(f.wf===v?Z.cA:{})}}>{l}</button>)}
    </div>
    <label style={Z.lb}>Boosters</label>
    <input style={Z.ip} value={f.boost||""} onChange={e=>sF(p=>({...p,boost:e.target.value}))} placeholder="e.g. Vitamin C, black pepper"/>
    <label style={Z.lb}>Food Interactions</label>
    <input style={Z.ip} value={f.fi||""} onChange={e=>sF(p=>({...p,fi:e.target.value}))} placeholder="e.g. Avoid dairy"/>
  </div>
  <div style={Z.fc}>
    <span style={Z.st}>{"üö´"} Conflicts</span>
    <div style={{display:"flex",gap:5,marginBottom:4}}>
      <select value={cn} onChange={e=>sCn(e.target.value)} style={{...Z.ip,marginBottom:0,flex:2}}><option value="">Select...</option>{supps.filter(x=>x.id!==init?.id).map(x=><option key={x.id} value={x.name}>{x.name}</option>)}</select>
      <input type="number" value={cm} onChange={e=>sCm(Number(e.target.value))} style={{...Z.ip,marginBottom:0,flex:1,minWidth:55}} placeholder="min"/>
      <button onClick={addC} style={Z.ab}>+</button>
    </div>
    <input style={{...Z.ip,marginTop:2}} value={ce} onChange={e=>sCe(e.target.value)} placeholder="Effect if taken together (e.g. Reduces absorption ~50%)"/>
    {f.confl.map((c,i)=><div key={i} style={{background:"#FEF3C7",borderRadius:8,padding:"6px 10px",marginBottom:4,fontSize:11,color:"#92400E"}}>
      <div style={{display:"flex",justifyContent:"space-between"}}><span>{"üö´"} {c.n} ‚Äî {c.m}min</span><button onClick={()=>sF(p=>({...p,confl:p.confl.filter((_,j)=>j!==i)}))} style={{background:"none",border:"none",color:"#92400E",cursor:"pointer"}}>x</button></div>
      {c.eff&&<p style={{fontSize:10,margin:"2px 0 0",color:"#B45309"}}>{c.eff}</p>}
    </div>)}
  </div>
  <div style={Z.fc}>
    <label style={Z.lb}>Stack</label>
    <select style={Z.ip} value={f.stackId||""} onChange={e=>sF(p=>({...p,stackId:e.target.value||null}))}><option value="">None</option>{stacks.map(s=><option key={s.id} value={s.id}>{s.name}</option>)}</select>
    <label style={Z.lb}>Notes</label>
    <textarea style={{...Z.ip,minHeight:50,resize:"vertical"}} value={f.note||""} onChange={e=>sF(p=>({...p,note:e.target.value}))} placeholder="Notes..."/>
  </div>
  <div style={{display:"flex",gap:8,marginTop:10,paddingBottom:90}}>
    <button onClick={()=>onSave(f)} style={Z.pb} disabled={!f.name.trim()}>{init?.id?"Save":"Add Supplement"}</button>
    {init?.id&&<button onClick={()=>{if(confirm("Delete?"))onDel(init.id);}} style={Z.db}>{"üóëÔ∏è"}</button>}
  </div>
</div>;
}

/* ‚îÄ‚îÄ‚îÄ SYMPTOM MODAL (outside App) ‚îÄ‚îÄ‚îÄ */
function SymMod({init,onSave,onClose}){
const[d,sD]=useState(init||{energy:5,sleep:5,digestion:5,mood:5,notes:""});
const Sl=({l,e,f})=><div style={{marginBottom:10}}>
  <div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}>
    <span style={{fontSize:11,fontWeight:600}}>{e} {l}</span>
    <span style={{fontSize:11,fontWeight:700,color:"#4ADE80"}}>{d[f]}/10</span>
  </div>
  <input type="range" min="1" max="10" value={d[f]} onChange={ev=>sD(p=>({...p,[f]:Number(ev.target.value)}))} style={{width:"100%"}}/>
</div>;
return <div style={{...Z.fc,marginBottom:12}}>
  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
    <span style={{fontSize:14,fontWeight:700}}>Daily Check-In</span>
    <button onClick={onClose} style={{background:"none",border:"none",fontSize:16,cursor:"pointer",color:"#9CA3AF"}}>{"√ó"}</button>
  </div>
  <Sl l="Energy" e="‚ö°" f="energy"/><Sl l="Sleep" e="üò¥" f="sleep"/><Sl l="Digestion" e="üçΩÔ∏è" f="digestion"/><Sl l="Mood" e="üòä" f="mood"/>
  <label style={Z.lb}>Notes</label>
  <textarea style={{...Z.ip,minHeight:40}} value={d.notes} onChange={e=>sD(p=>({...p,notes:e.target.value}))} placeholder="Notable..."/>
  <button onClick={()=>onSave(d)} style={Z.pb}>Save</button>
</div>;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function App(){
const[supps,setSupps]=useLS("ss3_s",[]);
const[logs,setLogs]=useLS("ss3_l",{});
const[stacks,setStacks]=useLS("ss3_st",[]);
const[timers,setTimers]=useLS("ss3_tm",{});
const[protos,setProtos]=useLS("ss3_pr",[]);
const[symptoms,setSymptoms]=useLS("ss3_sy",{});
const[library,setLibrary]=useLS("ss3_lib",[]);
const[resetHour,setResetHour]=useLS("ss3_rh",3);
const[hidden,setHidden]=useLS("ss3_hid",{});
const[alerts,setAlerts]=useLS("ss3_alerts",false);

const[view,setView]=useState("home");
const[editing,setEditing]=useState(null);
const[presetOpen,setPresetOpen]=useState(false);
const[conflWarn,setConflWarn]=useState(null);
const[histDate,setHistDate]=useState(tdy());
const[symOpen,setSymOpen]=useState(false);
const[editStk,setEditStk]=useState(null);
const[stkName,setStkName]=useState("");
const[toast,setToast]=useState("");
const[libQ,setLibQ]=useState("");
const[libExp,setLibExp]=useState(null);
const[libMsg,setLibMsg]=useState("");
const cRef=useRef(null);

/* ‚îÄ‚îÄ‚îÄ Reset check (no state, no re-render) ‚îÄ‚îÄ‚îÄ */
useEffect(()=>{
  const check=()=>{const n=new Date(),h=n.getHours();const rKey="ss3_lr2";const last=localStorage.getItem(rKey);const todayStr=tdy();const rid=todayStr+"-"+resetHour;if(h>=resetHour&&last!==rid){setTimers({});localStorage.setItem(rKey,rid);}};
  check();const i=setInterval(check,60000);return()=>clearInterval(i);
},[resetHour]);

/* ‚îÄ‚îÄ‚îÄ Alert check (notifications for scheduled times) ‚îÄ‚îÄ‚îÄ */
useEffect(()=>{
  if(!alerts)return;
  if(Notification.permission==="default")Notification.requestPermission();
  const check=()=>{
    if(Notification.permission!=="granted")return;
    const now=new Date(),nm=now.getHours()*60+now.getMinutes();
    const tk=tdy(),tl=logs[tk]||{};
    supps.forEach(s=>{
      if(tl[s.id])return;
      if(s.times?.[0]){const t=prsT(s.times[0]);if(t&&Math.abs(nm-(t.h*60+t.m))<=1){new Notification("Time to take "+s.name,{body:(s.dosage||"")+" "+(s.wf==="no"?"on empty stomach":s.wf==="fat"?"with fat":"with food"),icon:"üíä"});}}
    });
  };
  const i=setInterval(check,60000);return()=>clearInterval(i);
},[alerts,supps,logs]);

useEffect(()=>{if(cRef.current)cRef.current.scrollTop=0},[view]);

const tk=tdy(),tl=logs[tk]||{};
const hiddenToday=hidden[tk]||[];
const sorted=useMemo(()=>{const o={Morning:0,Midday:1,Evening:2,"Before bed":3,Anytime:4};return[...supps].sort((a,b)=>{if(a.times?.[0]&&b.times?.[0]){const ta=prsT(a.times[0]),tb=prsT(b.times[0]);if(ta&&tb)return(ta.h*60+ta.m)-(tb.h*60+tb.m);}return(o[a.bt]??4)-(o[b.bt]??4);})},[supps]);
const visible=sorted.filter(s=>!hiddenToday.includes(s.id));
const taken=Object.keys(tl).length,total=supps.length,pct=total>0?Math.round(taken/total*100):0;

const doTake=useCallback((s,cf)=>{if(cf&&cf.length){setConflWarn({s,c:cf});return;}const t=tdy(),ts=new Date().toISOString();setLogs(p=>({...p,[t]:{...(p[t]||{}),[s.id]:{time:ts,note:""}}}));setTimers(p=>({...p,[s.id+"_t"]:ts}));},[]);
const doForce=useCallback(()=>{if(!conflWarn)return;const s=conflWarn.s,t=tdy(),ts=new Date().toISOString();setLogs(p=>({...p,[t]:{...(p[t]||{}),[s.id]:{time:ts,note:"Override"}}}));setTimers(p=>({...p,[s.id+"_t"]:ts}));setConflWarn(null);},[conflWarn]);
const doUntake=useCallback(id=>{const t=tdy();setLogs(p=>{const d={...(p[t]||{})};delete d[id];return{...p,[t]:d};});setTimers(p=>{const n={...p};delete n[id+"_t"];return n;});},[]);
const saveSup=useCallback(f=>{if(editing?.id)setSupps(p=>p.map(s=>s.id===editing.id?{...f,id:s.id}:s));else setSupps(p=>[...p,{...f,id:uid()}]);setEditing(null);setView("home");},[editing]);
const delSup=useCallback(id=>{setSupps(p=>p.filter(s=>s.id!==id));setEditing(null);setView("home");},[]);
const addPreset=useCallback(p=>{setSupps(prev=>[...prev,{id:uid(),name:p.name,cat:p.cat,brand:"",dosage:"",form:"",times:[],wf:p.r.wf,es:p.r.wf==="no",bt:p.r.bt,boost:p.r.boost,confl:p.r.confl.map(c=>({n:c.n,m:c.m,eff:c.eff||""})),fi:"",note:p.r.note,stackId:null}]);setPresetOpen(false);},[]);
const saveStk=useCallback(d=>{if(editStk?.id)setStacks(p=>p.map(s=>s.id===editStk.id?{...d,id:s.id}:s));else setStacks(p=>[...p,{...d,id:uid()}]);setEditStk(null);setStkName("");},[editStk]);
const delStk=useCallback(id=>{setStacks(p=>p.filter(s=>s.id!==id));setSupps(p=>p.map(s=>s.stackId===id?{...s,stackId:null}:s));setEditStk(null);},[]);

const doExport=useCallback(()=>{const d=JSON.stringify({supps,logs,stacks,protos,symptoms},null,2);const b=new Blob([d],{type:"application/json"});const u=URL.createObjectURL(b);const a=document.createElement("a");a.href=u;a.download="supstack-"+tdy()+".json";a.click();URL.revokeObjectURL(u);setToast("Exported!");setTimeout(()=>setToast(""),2e3);},[supps,logs,stacks,protos,symptoms]);
const doImport=useCallback(e=>{const f=e.target.files?.[0];if(!f)return;const r=new FileReader();r.onload=ev=>{try{const d=JSON.parse(ev.target.result);if(d.supps)setSupps(d.supps);if(d.logs)setLogs(d.logs);if(d.stacks)setStacks(d.stacks);setToast("Imported!");setTimeout(()=>setToast(""),2e3);}catch{setToast("Bad file");}};r.readAsText(f);e.target.value="";},[]);
const doLibImport=useCallback(e=>{const f=e.target.files?.[0];if(!f)return;const r=new FileReader();r.onload=ev=>{try{const data=JSON.parse(ev.target.result);const arr=Array.isArray(data)?data:[data];const valid=arr.filter(i=>i.name);if(!valid.length){setLibMsg("No valid entries");setTimeout(()=>setLibMsg(""),2500);return;}setLibrary(prev=>{const merged=[...prev];let added=0;for(const item of valid){if(!merged.some(m=>m.name.toLowerCase()===item.name.toLowerCase())){merged.push({...item,_id:uid()});added++;}}setLibMsg("Added "+added+" new, "+(valid.length-added)+" skipped");setTimeout(()=>setLibMsg(""),3e3);return merged;});}catch{setLibMsg("Invalid JSON");setTimeout(()=>setLibMsg(""),2500);}};r.readAsText(f);e.target.value="";},[]);
const doLibDel=useCallback(id=>{setLibrary(p=>p.filter(x=>x._id!==id));if(libExp===id)setLibExp(null);},[libExp]);
const filtLib=useMemo(()=>{if(!libQ.trim())return library;const q=libQ.toLowerCase();return library.filter(s=>s.name?.toLowerCase().includes(q)||s.aliases?.some(a=>a.toLowerCase().includes(q))||s.category?.toLowerCase().includes(q)||s.tags?.some(t=>t.toLowerCase().includes(q))||s.description?.toLowerCase().includes(q));},[library,libQ]);

const unhide=(id)=>setHidden(p=>{const k=tdy();return{...p,[k]:(p[k]||[]).filter(x=>x!==id)};});

/* ‚îÄ‚îÄ‚îÄ Context value ‚îÄ‚îÄ‚îÄ */
const ctx=useMemo(()=>({supps,tl,timers,setEditing,setView,doTake,doUntake,hidden,setHidden,alerts}),[supps,tl,timers,doTake,doUntake,hidden,alerts]);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RENDER VIEWS (inline, not components ‚Äî no unmount/remount) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const renderHome=()=>{
  const h=new Date().getHours();
  const gr=h<12?"Good morning":h<17?"Good afternoon":"Good evening";
  const sgs={},ug=[];visible.forEach(s=>{if(s.stackId){if(!sgs[s.stackId])sgs[s.stackId]=[];sgs[s.stackId].push(s);}else ug.push(s);});
  return <div>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
      <div><p style={{fontSize:12,color:"#9CA3AF",margin:0}}>{gr}</p><h1 style={{fontSize:20,fontWeight:800,color:"#111",margin:"1px 0 0"}}>{"üíä"} My Protocol</h1></div>
      <button onClick={()=>setSymOpen(true)} style={{background:"#F3F4F6",border:"none",borderRadius:12,width:36,height:36,cursor:"pointer",fontSize:15}}>{"üìä"}</button>
    </div>
    <div style={{background:"linear-gradient(135deg,#ECFDF5,#D1FAE5)",borderRadius:20,padding:"14px 16px",marginBottom:12,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
      <div>
        <p style={{fontSize:11,color:"#059669",margin:0,fontWeight:600}}>Daily Progress</p>
        <p style={{fontSize:24,fontWeight:800,color:"#111",margin:"1px 0"}}>{taken}<span style={{fontSize:14,color:"#6B7280",fontWeight:500}}>/{total}</span></p>
        <p style={{fontSize:11,color:"#6B7280",margin:0}}>supplements taken</p>
      </div>
      <div style={{position:"relative",width:56,height:56}}><Ring p={pct}/><span style={{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",fontSize:12,fontWeight:800}}>{pct}%</span></div>
    </div>
    {symOpen&&<SymMod init={symptoms[tk]} onSave={d=>{setSymptoms(p=>({...p,[tk]:d}));setSymOpen(false);}} onClose={()=>setSymOpen(false)}/>}
    <div style={{display:"flex",gap:7,marginBottom:12}}>
      <button onClick={()=>{setEditing(null);setView("add");}} style={Z.qa}>{"+"} Add New</button>
      <button onClick={()=>setPresetOpen(true)} style={Z.qa}>{"üíä"} Preset</button>
    </div>
    {presetOpen&&<div style={Z.mo}><div style={Z.mC} className="su">
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}><span style={{fontSize:15,fontWeight:700}}>Presets</span><button onClick={()=>setPresetOpen(false)} style={{background:"none",border:"none",fontSize:18,cursor:"pointer",color:"#9CA3AF"}}>{"√ó"}</button></div>
      <div style={{maxHeight:"60vh",overflowY:"auto"}}>{PRESETS.map((p,i)=>{const ad=supps.some(s=>s.name===p.name);return <div key={i} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid #F3F4F6",opacity:ad?.5:1}}><div style={{flex:1}}><span style={{fontSize:12,fontWeight:600}}>{p.name}</span><p style={{fontSize:10,color:"#6B7280",margin:"1px 0 0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{p.r.note}</p></div><button onClick={()=>addPreset(p)} disabled={ad} style={{...Z.ab,opacity:ad?.4:1,marginLeft:6}}>{ad?"Added":"+ Add"}</button></div>;})}</div>
    </div></div>}
    {conflWarn&&<div style={Z.mo}><div style={{...Z.mC,maxWidth:340}} className="su">
      <div style={{textAlign:"center",marginBottom:12}}>
        <div style={{fontSize:32,marginBottom:5}}>{"‚ö†Ô∏è"}</div>
        <h3 style={{margin:"0 0 5px",fontSize:15,fontWeight:700}}>Conflict Detected</h3>
        <p style={{fontSize:11,color:"#6B7280",margin:0}}>Taking <strong>{conflWarn.s.name}</strong> now may cause issues</p>
      </div>
      {conflWarn.c.map((c,i)=>{const elapsed=c.total-c.rem;const pctAbsorb=Math.max(5,Math.round((elapsed/c.total)*100));
        return <div key={i} style={{background:"#FEF3C7",borderRadius:10,padding:"10px 12px",marginBottom:6}}>
          <p style={{fontSize:11,fontWeight:700,color:"#92400E",margin:0}}>{"üö´"} {c.name} ‚Äî {c.rem}min left</p>
          {c.eff&&<p style={{fontSize:10,color:"#B45309",margin:"3px 0 0",fontWeight:600}}>{c.eff}</p>}
          <div style={{marginTop:5,background:"#FDE68A",borderRadius:6,padding:"4px 8px"}}>
            <p style={{fontSize:10,color:"#92400E",margin:0}}>{"üìâ"} ~{pctAbsorb}% effectiveness if taken now</p>
            <div style={{marginTop:3,height:5,background:"#FEF3C7",borderRadius:3,overflow:"hidden"}}><div style={{height:"100%",width:pctAbsorb+"%",background:pctAbsorb>60?"#F59E0B":"#DC2626",borderRadius:3}}/></div>
          </div>
        </div>;})}
      <div style={{display:"flex",gap:8,marginTop:12}}>
        <button onClick={()=>setConflWarn(null)} style={{...Z.pb,background:"#E5E7EB",color:"#374151"}}>Wait</button>
        <button onClick={doForce} style={{...Z.pb,background:"#F59E0B",color:"#fff"}}>Take Anyway</button>
      </div>
    </div></div>}
    {Object.keys(sgs).map(sid=>{const sk=stacks.find(s=>s.id===sid),ss=sgs[sid],at=ss.every(s=>tl[s.id]);
      return <div key={sid} style={{marginBottom:12}}>
        <div style={{display:"flex",alignItems:"center",gap:5,marginBottom:5}}><span style={{fontSize:12,fontWeight:700,color:"#374151"}}>{sk?.name||"Stack"}</span>{at&&<span style={{fontSize:10,color:"#16A34A",fontWeight:600}}>All done</span>}</div>
        <div style={{borderLeft:"2px solid #E5E7EB",paddingLeft:10,marginLeft:3}}>{ss.map(s=><SC key={s.id} s={s}/>)}</div>
      </div>;})}
    {ug.length>0&&<div>{Object.keys(sgs).length>0&&<p style={{fontSize:11,fontWeight:600,color:"#9CA3AF",margin:"0 0 5px"}}>Individual</p>}{ug.map(s=><SC key={s.id} s={s}/>)}</div>}
    {hiddenToday.length>0&&<div style={{marginTop:8}}>
      <p style={{fontSize:11,color:"#9CA3AF",marginBottom:4}}>{"üëã"} {hiddenToday.length} hidden today</p>
      <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>{hiddenToday.map(id=>{const s=supps.find(x=>x.id===id);if(!s)return null;return <button key={id} onClick={()=>unhide(id)} style={{fontSize:10,background:"#F3F4F6",border:"none",borderRadius:6,padding:"3px 8px",cursor:"pointer",color:"#6B7280"}}>{s.name} √ó</button>;})}</div>
    </div>}
    {supps.length===0&&<div style={{textAlign:"center",padding:"32px 14px",color:"#9CA3AF"}}><div style={{fontSize:40,marginBottom:8}}>{"üíä"}</div><p style={{fontSize:13,fontWeight:600,margin:0}}>No supplements yet</p></div>}
  </div>;
};

const renderHistory=()=>{
  const dt=new Date(histDate+"T12:00:00");const ms=new Date(dt.getFullYear(),dt.getMonth(),1);const me=new Date(dt.getFullYear(),dt.getMonth()+1,0);
  const sd=ms.getDay(),dim=me.getDate();const mn=dt.toLocaleDateString("en-US",{month:"long",year:"numeric"});
  const prev=()=>{const d=new Date(dt);d.setMonth(d.getMonth()-1);setHistDate(d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-01");};
  const next=()=>{const d=new Date(dt);d.setMonth(d.getMonth()+1);setHistDate(d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-01");};
  const dl=logs[histDate]||{},ds=symptoms[histDate];
  return <div>
    <h2 style={{fontSize:18,fontWeight:800,color:"#111",margin:"0 0 12px"}}>History</h2>
    <div style={{background:"#fff",borderRadius:16,padding:12,boxShadow:"0 1px 3px rgba(0,0,0,.04)",marginBottom:12}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}><button onClick={prev} style={{background:"none",border:"none",cursor:"pointer",fontSize:16}}>{"<"}</button><span style={{fontSize:13,fontWeight:700}}>{mn}</span><button onClick={next} style={{background:"none",border:"none",cursor:"pointer",fontSize:16}}>{">"}</button></div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:1,textAlign:"center"}}>
        {["S","M","T","W","T","F","S"].map((d,i)=><div key={i} style={{fontSize:10,fontWeight:600,color:"#9CA3AF",padding:"2px 0"}}>{d}</div>)}
        {Array.from({length:sd}).map((_,i)=><div key={"e"+i}/>)}
        {Array.from({length:dim}).map((_,i)=>{const day=i+1;const dk=dt.getFullYear()+"-"+String(dt.getMonth()+1).padStart(2,"0")+"-"+String(day).padStart(2,"0");const dlg=logs[dk]||{},cnt=Object.keys(dlg).length,sel=dk===histDate,isTd=dk===tdy();const p=total>0?cnt/total:0;let bg="transparent";if(p>=1)bg="#DCFCE7";else if(p>=.5)bg="#FEF9C3";else if(p>0)bg="#FEE2E2";
          return <button key={day} onClick={()=>setHistDate(dk)} style={{width:32,height:32,borderRadius:8,border:sel?"2px solid #4ADE80":isTd?"2px solid #D1D5DB":"2px solid transparent",background:sel?"#ECFDF5":bg,cursor:"pointer",fontSize:11,fontWeight:sel?700:500,color:"#374151",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto"}}>{day}</button>;})}
      </div>
    </div>
    <h3 style={{fontSize:13,fontWeight:700,color:"#374151",margin:"0 0 6px"}}>{new Date(histDate+"T12:00:00").toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}</h3>
    {supps.map(s=>{const lg=dl[s.id];return <div key={s.id} style={{background:"#F9FAFB",borderRadius:10,padding:"8px 11px",marginBottom:4,borderLeft:"3px solid "+(lg?"#4ADE80":"#E5E7EB")}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontSize:11,fontWeight:600,color:lg?"#111":"#9CA3AF"}}>{s.name}</span>{lg?<span style={{fontSize:10,color:"#16A34A"}}>{"‚úì"} {new Date(lg.time).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}</span>:<span style={{fontSize:10,color:"#D1D5DB"}}>‚Äî</span>}</div></div>;})}
    {ds&&<div style={{background:"#F0FDF4",borderRadius:10,padding:10,marginTop:6}}><p style={{fontSize:11,fontWeight:700,margin:"0 0 4px"}}>Check-In</p><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:3}}><span style={{fontSize:10}}>{"‚ö°"}{ds.energy}/10</span><span style={{fontSize:10}}>{"üò¥"}{ds.sleep}/10</span><span style={{fontSize:10}}>{"üçΩÔ∏è"}{ds.digestion}/10</span><span style={{fontSize:10}}>{"üòä"}{ds.mood}/10</span></div></div>}
  </div>;
};

const renderLibrary=()=>{
  const Pills=({items,color})=><div style={{display:"flex",gap:4,flexWrap:"wrap"}}>{(items||[]).map((x,i)=><span key={i} style={{fontSize:10,background:color+"18",color,padding:"3px 8px",borderRadius:6,fontWeight:500}}>{x}</span>)}</div>;
  const renderEntry=(entry)=>{const isE=libExp===entry._id;const cc=CC[entry.category]||"#6B7280";
    return <div key={entry._id} style={{background:"#fff",borderRadius:16,marginBottom:8,boxShadow:"0 1px 3px rgba(0,0,0,.04)",overflow:"hidden",borderLeft:"4px solid "+cc}}>
      <button onClick={()=>setLibExp(isE?null:entry._id)} style={{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 14px",border:"none",background:"none",cursor:"pointer",textAlign:"left"}}>
        <div style={{flex:1,minWidth:0}}>
          <div style={{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}}><span style={{fontSize:14,fontWeight:700,color:"#111"}}>{entry.name}</span><span style={{fontSize:9,background:cc+"22",color:cc,padding:"2px 7px",borderRadius:5,fontWeight:600}}>{entry.category}</span></div>
          {entry.aliases?.length>0&&<p style={{fontSize:10,color:"#9CA3AF",margin:"2px 0 0"}}>aka: {entry.aliases.join(", ")}</p>}
          <p style={{fontSize:11,color:"#6B7280",margin:"3px 0 0",display:"-webkit-box",WebkitLineClamp:isE?999:2,WebkitBoxOrient:"vertical",overflow:"hidden"}}>{entry.description}</p>
        </div><span style={{marginLeft:8,color:"#9CA3AF",fontSize:12}}>{isE?"‚ñ≤":"‚ñº"}</span>
      </button>
      {isE&&<div style={{padding:"0 14px 14px"}}>
        <div style={{display:"flex",gap:5,flexWrap:"wrap",marginBottom:12}}><Mt>{entry.emptyStomach==="preferred"||entry.emptyStomach===true?"üíä Empty stomach":entry.withFood?.includes("fat")?"ü•ë With fat":"üçΩÔ∏è With food"}</Mt><Mt>{"‚è∞"} {entry.timing||"Anytime"}</Mt>{entry.typicalDosage&&<Mt>{"üíä"} {entry.typicalDosage}</Mt>}</div>
        {entry.bestWayToTake&&<div style={{marginBottom:12}}><p style={{fontSize:12,fontWeight:700,color:"#374151",margin:"0 0 6px"}}>{"üìã"} How to Take</p><p style={{fontSize:11,color:"#374151",margin:0,lineHeight:1.5,background:"#F0FDF4",padding:"8px 10px",borderRadius:8}}>{entry.bestWayToTake}</p></div>}
        {entry.benefits?.length>0&&<div style={{marginBottom:12}}><p style={{fontSize:12,fontWeight:700,color:"#374151",margin:"0 0 6px"}}>{"‚úÖ"} Benefits</p>{entry.benefits.map((b,i)=><div key={i} style={{fontSize:11,color:"#374151",marginBottom:2}}>{"‚Ä¢ "}{b}</div>)}</div>}
        {entry.synergies?.length>0&&<div style={{marginBottom:12}}><p style={{fontSize:12,fontWeight:700,color:"#374151",margin:"0 0 6px"}}>{"ü§ù"} Works Well With</p>{entry.synergies.map((s,i)=><div key={i} style={{background:"#ECFDF5",borderRadius:10,padding:"8px 10px",marginBottom:4}}><span style={{fontSize:12,fontWeight:700,color:"#059669"}}>{s.name}</span><p style={{fontSize:10,color:"#374151",margin:"2px 0 0",lineHeight:1.4}}>{s.detail}</p></div>)}</div>}
        {entry.conflicts?.length>0&&<div style={{marginBottom:12}}><p style={{fontSize:12,fontWeight:700,color:"#374151",margin:"0 0 6px"}}>{"üö´"} Conflicts</p>{entry.conflicts.map((c,i)=><div key={i} style={{background:"#FEF3C7",borderRadius:10,padding:"8px 10px",marginBottom:4}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontSize:12,fontWeight:700,color:"#92400E"}}>{c.name}</span>{c.separationMinutes&&<span style={{fontSize:9,background:"#FCD34D",color:"#92400E",padding:"2px 6px",borderRadius:4,fontWeight:700}}>{c.separationMinutes}min</span>}</div><p style={{fontSize:10,color:"#B45309",margin:"2px 0 0",lineHeight:1.4}}>{c.detail}</p></div>)}</div>}
        {entry.sideEffects?.length>0&&<div style={{marginBottom:12}}><p style={{fontSize:12,fontWeight:700,color:"#374151",margin:"0 0 6px"}}>{"‚ö°"} Side Effects</p>{entry.sideEffects.map((e,i)=><div key={i} style={{fontSize:11,color:"#6B7280",marginBottom:2}}>{"‚Ä¢ "}{e}</div>)}</div>}
        {entry.deficiencySymptoms?.length>0&&<div style={{marginBottom:12}}><p style={{fontSize:12,fontWeight:700,color:"#374151",margin:"0 0 6px"}}>{"üîª"} Deficiency Signs</p><Pills items={entry.deficiencySymptoms} color="#EF4444"/></div>}
        {entry.foodSources?.length>0&&<div style={{marginBottom:12}}><p style={{fontSize:12,fontWeight:700,color:"#374151",margin:"0 0 6px"}}>{"ü•ó"} Food Sources</p><Pills items={entry.foodSources} color="#10B981"/></div>}
        {entry.tags?.length>0&&<div style={{marginBottom:8}}><Pills items={entry.tags} color="#6B7280"/></div>}
        <button onClick={()=>{if(confirm('Remove "'+entry.name+'"?'))doLibDel(entry._id);}} style={{width:"100%",background:"#FEE2E2",border:"none",borderRadius:10,padding:"8px 12px",fontSize:11,fontWeight:700,color:"#DC2626",cursor:"pointer"}}>{"üóëÔ∏è"} Remove</button>
      </div>}
    </div>;};
  return <div>
    <h2 style={{fontSize:18,fontWeight:800,color:"#111",margin:"0 0 2px"}}>{"üìö"} Supplement Library</h2>
    <p style={{fontSize:11,color:"#9CA3AF",margin:"0 0 10px"}}>Your personal supplement encyclopedia</p>
    <input type="search" value={libQ} onChange={e=>setLibQ(e.target.value)} placeholder={"üîç Search name, tags, category..."} style={{...Z.ip,paddingLeft:12,marginBottom:8,background:"#fff"}}/>
    <div style={{display:"flex",gap:6,marginBottom:10,alignItems:"center"}}><label style={{...Z.ab,cursor:"pointer",flex:1,justifyContent:"center"}}>{"üìÇ"} Import JSON<input type="file" accept=".json" onChange={doLibImport} style={{display:"none"}}/></label><span style={{fontSize:11,color:"#9CA3AF"}}>{library.length} entries</span></div>
    {libMsg&&<div style={{background:libMsg.includes("Invalid")?"#FEE2E2":"#DCFCE7",borderRadius:10,padding:"8px 12px",marginBottom:10,fontSize:11,fontWeight:600,color:libMsg.includes("Invalid")?"#DC2626":"#16A34A"}}>{libMsg}</div>}
    {filtLib.length>0?filtLib.map(renderEntry):library.length===0?<div style={{textAlign:"center",padding:"32px 14px",color:"#9CA3AF"}}><div style={{fontSize:40,marginBottom:8}}>{"üìö"}</div><p style={{fontSize:13,fontWeight:600,margin:"0 0 4px"}}>Library is empty</p><p style={{fontSize:11,margin:"0 0 12px"}}>Import a JSON to build your encyclopedia</p><div style={{background:"#F9FAFB",borderRadius:10,padding:12,textAlign:"left"}}><pre style={{fontSize:9,color:"#6B7280",margin:0,whiteSpace:"pre-wrap"}}>{'[\n  {\n    "name": "Magnesium Glycinate",\n    "category": "mineral",\n    "description": "...",\n    "benefits": [...],\n    "synergies": [{"name":"...","detail":"..."}],\n    "conflicts": [{"name":"...","detail":"...",\n      "separationMinutes":120}],\n    "tags": ["sleep"]\n  }\n]'}</pre></div></div>:libQ?<div style={{textAlign:"center",padding:"24px",color:"#9CA3AF"}}><p style={{fontSize:12}}>No results for "{libQ}"</p></div>:null}
    <div style={{height:80}}/>
  </div>;
};

const renderSettings=()=><div>
  <h2 style={{fontSize:18,fontWeight:800,color:"#111",margin:"0 0 12px"}}>Settings</h2>
  <div style={{...Z.fc,marginBottom:12}}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}><span style={{fontSize:13,fontWeight:700}}>{"üì¶"} Stacks</span><button onClick={()=>{setEditStk({});setStkName("");}} style={Z.ab}>+ New</button></div>
    {editStk&&<div style={{background:"#F9FAFB",borderRadius:10,padding:10,marginBottom:6}}>
      <input style={Z.ip} value={stkName} onChange={e=>setStkName(e.target.value)} placeholder="Stack name..." autoFocus/>
      <div style={{display:"flex",gap:5}}><button onClick={()=>{if(stkName.trim())saveStk({...editStk,name:stkName.trim()});}} style={Z.ab}>Save</button><button onClick={()=>{setEditStk(null);setStkName("");}} style={{...Z.ab,background:"#F3F4F6",color:"#6B7280"}}>Cancel</button></div>
    </div>}
    {stacks.map(sk=><div key={sk.id} style={{background:"#F9FAFB",borderRadius:9,padding:"8px 10px",marginBottom:4}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><span style={{fontSize:12,fontWeight:600}}>{sk.name}</span><p style={{fontSize:10,color:"#6B7280",margin:"1px 0 0"}}>{supps.filter(s=>s.stackId===sk.id).length} supps</p></div><div style={{display:"flex",gap:4}}><button onClick={()=>{setEditStk(sk);setStkName(sk.name);}} style={{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"}}>{"‚úèÔ∏è"}</button><button onClick={()=>{if(confirm("Delete?"))delStk(sk.id);}} style={{background:"none",border:"none",cursor:"pointer",color:"#EF4444"}}>{"üóëÔ∏è"}</button></div></div></div>)}
  </div>
  <div style={{...Z.fc,marginBottom:12}}>
    <span style={{fontSize:13,fontWeight:700,display:"block",marginBottom:6}}>{"üîî"} Alerts</span>
    <p style={{fontSize:10,color:"#6B7280",margin:"0 0 6px"}}>Get notified when it's time to take supplements and when conflict timers expire</p>
    <button onClick={()=>{if(!alerts&&Notification.permission==="default")Notification.requestPermission();setAlerts(!alerts);}} style={{...Z.ch,...(alerts?Z.cA:{})}}>{alerts?"üîî Alerts ON":"üîï Alerts OFF"}</button>
  </div>
  <div style={{...Z.fc,marginBottom:12}}>
    <span style={{fontSize:13,fontWeight:700,display:"block",marginBottom:6}}>{"üîÑ"} Daily Reset</span>
    <p style={{fontSize:10,color:"#6B7280",margin:"0 0 8px"}}>Reset all checkmarks at this time each day</p>
    <div style={{display:"flex",gap:5,flexWrap:"wrap"}}>{[0,1,2,3,4,5,6].map(h=><button key={h} onClick={()=>setResetHour(h)} style={{...Z.ch,...(resetHour===h?Z.cA:{}),minWidth:48,textAlign:"center"}}>{h===0?"12 AM":h+" AM"}</button>)}</div>
    <p style={{fontSize:10,color:"#9CA3AF",margin:"6px 0 0"}}>Currently resets at {resetHour===0?"12:00 AM":resetHour+":00 AM"}</p>
  </div>
  <div style={{...Z.fc,marginBottom:12}}>
    <span style={{fontSize:13,fontWeight:700,display:"block",marginBottom:6}}>{"üìã"} Protocols</span>
    <button onClick={()=>{const n=prompt("Name:");if(n)setProtos(p=>[...p,{id:uid(),name:n,supps:JSON.parse(JSON.stringify(supps)),stacks:JSON.parse(JSON.stringify(stacks)),at:new Date().toISOString()}]);}} style={Z.ab}>Save Current</button>
    {protos.map(p=><div key={p.id} style={{background:"#F9FAFB",borderRadius:9,padding:"8px 10px",marginTop:5}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><span style={{fontSize:11,fontWeight:600}}>{p.name}</span><p style={{fontSize:9,color:"#9CA3AF",margin:0}}>{p.supps.length} supps</p></div><div style={{display:"flex",gap:4}}><button onClick={()=>{if(confirm("Load?")){setSupps(p.supps);if(p.stacks)setStacks(p.stacks);}}} style={Z.ab}>Load</button><button onClick={()=>{if(confirm("Delete?"))setProtos(prev=>prev.filter(x=>x.id!==p.id));}} style={{background:"none",border:"none",cursor:"pointer",color:"#EF4444"}}>{"üóëÔ∏è"}</button></div></div></div>)}
  </div>
  <div style={{...Z.fc,marginBottom:12}}>
    <span style={{fontSize:13,fontWeight:700,display:"block",marginBottom:6}}>{"üíæ"} Backup</span>
    <div style={{display:"flex",gap:5}}><button onClick={doExport} style={Z.ab}>{"‚¨áÔ∏è"} Export</button><label style={{...Z.ab,cursor:"pointer"}}>{"üìÇ"} Import<input type="file" accept=".json" onChange={doImport} style={{display:"none"}}/></label></div>
    {toast&&<p style={{fontSize:10,color:"#16A34A",marginTop:5}}>{toast}</p>}
  </div>
  <div style={{...Z.fc,marginBottom:12}}>
    <span style={{fontSize:13,fontWeight:700,display:"block",marginBottom:6}}>{"üì¶"} All Supplements ({supps.length})</span>
    {supps.map(s=><div key={s.id} style={{background:"#F9FAFB",borderRadius:9,padding:"8px 10px",marginBottom:3}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontSize:11,fontWeight:600}}>{s.name}</span><button onClick={()=>{setEditing(s);setView("add");}} style={{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"}}>{"‚úèÔ∏è"}</button></div></div>)}
  </div>
  <div style={{height:80}}/>
</div>;

/* ‚ïê‚ïê‚ïê MAIN RENDER ‚ïê‚ïê‚ïê */
return <Ctx.Provider value={ctx}>
<div style={{height:"100vh",display:"flex",justifyContent:"center",background:"#F5F5F0",overflow:"hidden"}}>
  <div style={{width:"100%",maxWidth:480,height:"100vh",background:"#FAFAF8",position:"relative",display:"flex",flexDirection:"column",boxShadow:"0 0 40px rgba(0,0,0,.08)",overflow:"hidden"}}>
    <div ref={cRef} style={{flex:1,overflowY:"auto",padding:"20px 14px 96px",WebkitOverflowScrolling:"touch"}}>
      {view==="home"&&renderHome()}
      {view==="history"&&renderHistory()}
      {view==="add"&&<SF key={editing?.id||"new"} init={editing} onSave={saveSup} onDel={delSup} onBack={()=>{setEditing(null);setView("home");}} supps={supps} stacks={stacks}/>}
      {view==="library"&&renderLibrary()}
      {view==="settings"&&renderSettings()}
    </div>
    <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:480,display:"flex",justifyContent:"space-around",alignItems:"flex-end",padding:"6px 0 env(safe-area-inset-bottom, 14px)",background:"rgba(255,255,255,.97)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderTop:"1px solid #F3F4F6",zIndex:100}}>
      {[{k:"home",l:"Today",e:"üè†"},{k:"history",l:"History",e:"üìÖ"},{k:"add",l:"",e:"+",sp:true},{k:"library",l:"Library",e:"üìö"},{k:"settings",l:"Settings",e:"‚öôÔ∏è"}].map(it=>
        <button key={it.k} onClick={()=>{if(it.k==="add")setEditing(null);setView(it.k);}}
          style={{display:"flex",flexDirection:"column",alignItems:"center",background:it.sp?"#4ADE80":"none",border:"none",cursor:"pointer",
            padding:it.sp?"0":"3px 8px",color:it.sp?"#fff":view===it.k?"#4ADE80":"#9CA3AF",fontSize:it.sp?20:18,
            ...(it.sp?{borderRadius:16,width:46,height:46,justifyContent:"center",boxShadow:"0 4px 14px rgba(74,222,128,.35)",marginBottom:8}:{})}}>
          <span>{it.e}</span>
          {!it.sp&&<span style={{fontSize:9,marginTop:1,fontWeight:view===it.k?700:500}}>{it.l}</span>}
        </button>)}
    </div>
  </div>
</div>
</Ctx.Provider>;
}

const Z={
fc:{background:"#fff",borderRadius:16,padding:12,marginBottom:8,boxShadow:"0 1px 3px rgba(0,0,0,.04)"},
lb:{display:"block",fontSize:10,fontWeight:600,color:"#6B7280",marginBottom:2,marginTop:7},
st:{fontSize:12,fontWeight:700,color:"#374151",display:"block",marginBottom:5},
ip:{width:"100%",padding:"9px 11px",border:"1.5px solid #E5E7EB",borderRadius:10,fontSize:13,outline:"none",marginBottom:6,background:"#FAFAF8",color:"#111"},
ch:{padding:"5px 10px",borderRadius:20,border:"1.5px solid #E5E7EB",background:"#fff",fontSize:11,fontWeight:500,cursor:"pointer",color:"#374151"},
cA:{background:"#ECFDF5",borderColor:"#4ADE80",color:"#059669",fontWeight:700},
ab:{background:"#ECFDF5",border:"1.5px solid #A7F3D0",borderRadius:10,padding:"7px 11px",fontSize:11,fontWeight:600,color:"#059669",cursor:"pointer",display:"flex",alignItems:"center",gap:3,whiteSpace:"nowrap"},
pb:{flex:1,background:"#4ADE80",border:"none",borderRadius:12,padding:"11px 16px",fontSize:13,fontWeight:700,color:"#fff",cursor:"pointer"},
db:{background:"#FEE2E2",border:"none",borderRadius:12,padding:"10px 14px",fontSize:12,fontWeight:700,color:"#DC2626",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},
tb:{border:"none",borderRadius:12,width:38,height:38,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 6px rgba(0,0,0,.08)",fontSize:14,fontWeight:700},
qa:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:4,background:"#fff",border:"1.5px solid #E5E7EB",borderRadius:14,padding:"10px 12px",fontSize:12,fontWeight:600,color:"#374151",cursor:"pointer"},
mo:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:200,padding:14,backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)"},
mC:{background:"#fff",borderRadius:20,padding:18,maxWidth:380,width:"100%",maxHeight:"80vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},
};

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
